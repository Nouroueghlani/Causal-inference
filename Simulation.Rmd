---
title: "R Notebook"
output: html_notebook
---

Commençons par définir deux groupes:

-   **Groupe traitement:** c'est le groupe des personnes à qui on a attribué un traitement (T=1).

-   **Groupe de contrôle:** c'est le groupe des personnes à qui on n'a pas attrivué de traitement (T=0).

On a opté pour la distribution des deux groupes pour une loi normale qui sera cependant de moyennes distinctes relativement à chaque groupe.

On fixe également la taille N des deux échantillons à 1000 pour chaque groupe.

```{r}
#Parametres
N=1000
mean_treatment <- 110 # Moyenne de Ytreatment
sd_treatment <- 10    # Ecart-type du groupe de treatment
mean_control <- 120   # Moyenne de Ycontol
sd_control <- 10      # Ecart-type du groupe de control
```

```{r}
treatment_group <- rnorm(N, mean_treatment, sd_treatment) #Vecteur outcome du groupe de treatment
control_group <- rnorm(N, mean_control, sd_control) #Vecteur outcome du groupe de control
```

```{r}
# Attribution aléatoire du traitement 
allocation <- sample(c(0, 1), size = N, replace = TRUE) #Vecteur contenant des valeurs dans {0,1} générée par une loi uniforme.
```

Le vecteur allocation nous permettra d'attribuer le traitement aux individus d'une façon aléatoire et indépendante.

```{r}
# Simulation des résultats
simulated_results <- ifelse(allocation == 0, control_group, treatment_group)
```

Pour accèder au groupe de treatement (resp groupe control), on utilise:

-   simulated_results[allocation == 1] : groupe des traités avec une variation aléatoire

-   simulated_results[allocation == 0] : groupe des non-traités avec une variation aléatoire

```{r}
# Analyse statistique des estimations
treatment_mean <- mean(simulated_results[allocation == 1])
control_mean <- mean(simulated_results[allocation == 0])
```

Visualisation l'effet du traitement.

```{r}
effet_treat=treatment_mean - control_mean
effet_treat
```

On veut tester cet estimateur par un test de student:

```{r}
result<-t.test(simulated_results[allocation==1]-simulated_results[allocation==0],y=NULL,alternative = "two.sided",mu = mean_control-mean_treatment,var.equal =TRUE)
result
```

On obtient une P-value inférieur à 0.05 donc le test est significatif. Un résultat qui peut être vérifier autrement

```{r}
df <- result$parameter
tobs <- result$statistic
alpha <- 0.05
critical_value <- qt(1 - alpha/2, df)
if (abs(tobs) > critical_value) {
  cat("Le test est significatif.\n")
} else {
  cat("Le test n'est pas significatif.\n")
}
```

## Observational Data:

### OLS estimator-Regression adjustment-gformula

```{r}
Nt=150
Nc=133
meanX_ageT<-65
sd_XT <- 5
meanX_ageC <-20
sd_XC <-5
To<-10
alpha<-15
```

```{r}
Xt<-rnorm(Nt, meanX_ageT, sd_XT)
Xc<-rnorm(Nc, meanX_ageC, sd_XC)
```

```{r}
Yt<-To+alpha*Xt
Yc<-alpha*Xc
X<-c(Xt,Xc)
```

```{r}
#Tracer le premier graphique
plot(Xt, Yt,type = "p", col = "blue", xlab = "X", ylab = "Y",xlim=c(0,90),ylim=c(100,1400))

#Tracer le second graphique
lines(Xc, Yc,type = "p", col = "red")
```

```{r}
#regression lineaire:
res1 <-lm(Yt~Xt)
res2 <-lm(Yc~Xc)
```

```{r}
Y_est1 <- as.matrix(cbind(res1$fitted.values))
Y_est2 <- as.matrix(cbind(res2$fitted.values))
X<-seq(from = 0, to = 85, length.out = 1000)
theta.est1 <- res1$coefficients
theta.est2 <- res2$coefficients
```

```{r}
#Tracer le premier graphique
plot(Xt, Yt,type = "p", col = "blue", xlab = "X", ylab = "Y",xlim=c(0,90),ylim=c(100,1400))
#Tracer le second graphique
lines(Xc, Yc,type = "p", col = "red")
lines(X,theta.est1[2]*X+theta.est1[1],type="l",col="blue")
lines(X,theta.est2[2]*X+theta.est2[1],type="l",col="red")
```

```{r}
tau<-theta.est1[1]+sum(theta.est1[2]*X)-theta.est2[1]-sum(theta.est2[2]*X)
tau
```

```{r}

```
